import tkinter as tk
from tkinter import ttk, messagebox, filedialog
import time
import os
import hashlib 

class HashFolderAnalyzerApp:
    def __init__(self, master):
        self.master = master
        master.title("üîç Analizador de Carpetas: Nombres y HASH SHA256")
        master.geometry("850x700") 
        self.create_widgets()

    def create_widgets(self):
        """Define la estructura y elementos de la GUI."""
        
        style = ttk.Style()
        style.configure('TButton', font=('Arial', 10, 'bold'), padding=6)
        style.configure('TLabel', font=('Arial', 10))
        
        control_frame = ttk.LabelFrame(self.master, text="‚úÖ 1. Seleccionar y Analizar", padding="15 15 15 15")
        control_frame.pack(padx=20, pady=20, fill="x")

        self.status_label = ttk.Label(control_frame, text="Estado: Listo para seleccionar carpeta.", foreground="blue", font=('Arial', 11, 'bold'))
        self.status_label.pack(pady=10)

        analyze_button = ttk.Button(control_frame, 
                                    text="üìÇ ANALIZAR CARPETA Y GENERAR HASHES", 
                                    command=self.analizar_carpeta_completa,
                                    width=50)
        analyze_button.pack(pady=15)
        
        result_frame = ttk.LabelFrame(self.master, text="üìà 2. Resultados (Nombre vs. Hash SHA256)", padding="10 10 10 10")
        result_frame.pack(padx=20, pady=10, fill="both", expand=True)

        self.result_text = tk.Text(result_frame, wrap="word", height=25, font=('Consolas', 10))
        self.result_text.pack(fill="both", expand=True, padx=5, pady=5)
        
    
    def calcular_sha256(self, nombre_archivo):
        """Calcula el hash SHA256 de una cadena de texto."""
        try:
            hash_object = hashlib.sha256(nombre_archivo.encode('utf-8'))
            return hash_object.hexdigest()
        except Exception:
            return "ERROR_HASH"
            
    
    def analizar_carpeta_completa(self):
        """Abre el di√°logo, lee los archivos y muestra el nombre y hash de cada uno."""
        
        self.result_text.delete('1.0', tk.END) 
        folder_path = filedialog.askdirectory(title="Selecciona la Carpeta a Analizar")
        
        if not folder_path:
            self.status_label.config(text="Estado: An√°lisis cancelado por el usuario.", foreground="red")
            return

        try:
            inicio_total = time.time()
            self.status_label.config(text=f"Analizando: {os.path.basename(folder_path)}...", foreground="orange")
            self.master.update() 
            
            nombres_elementos = os.listdir(folder_path)
            
            if not nombres_elementos:
                messagebox.showwarning("Carpeta Vac√≠a", "La carpeta seleccionada no contiene elementos.")
                self.status_label.config(text="Estado: An√°lisis completado (Carpeta Vac√≠a).", foreground="red")
                return

            self.result_text.insert(tk.END, f"--- AN√ÅLISIS DE CARPETA: {folder_path} ---\n\n")
            
            width_nombre = 35 
            width_hash = 64 
            
            separator = "-" * (width_nombre + width_hash + 9) + "\n"
            self.result_text.insert(tk.END, separator)
            self.result_text.insert(tk.END, f"| {'NOMBRE DEL ELEMENTO':<{width_nombre}} | {'HASH SHA256 DEL NOMBRE':<{width_hash}} |\n")
            self.result_text.insert(tk.END, separator)
            
            elementos_procesados = 0
            
            for nombre in nombres_elementos:
                hash_value = self.calcular_sha256(nombre)
                
                nombre_display = (nombre[:width_nombre-3] + '...') if len(nombre) > width_nombre else nombre
                
                self.result_text.insert(tk.END, f"| {nombre_display:<{width_nombre}} | {hash_value:<{width_hash}} |\n")
                elementos_procesados += 1
            
            self.result_text.insert(tk.END, separator)
            
            fin_total = time.time()
            tiempo_total = (fin_total - inicio_total) * 1000

            self.status_label.config(text=f"‚úÖ An√°lisis Completado: {elementos_procesados} elementos procesados.", foreground="green")
            self.result_text.insert(tk.END, f"\nResumen: {elementos_procesados} elementos procesados.\n")
            self.result_text.insert(tk.END, f"‚è±Ô∏è Tiempo total de an√°lisis y hashing: {tiempo_total:.4f} ms\n")
            
        except Exception as e:
            messagebox.showerror("Error de An√°lisis", f"Ocurri√≥ un error al procesar la carpeta.\nError: {e}")
            self.status_label.config(text="üõë Error en el an√°lisis. Ver terminal para detalles.", foreground="red")


if __name__ == "__main__":
    root = tk.Tk()
    app = HashFolderAnalyzerApp(root)
    root.mainloop()
